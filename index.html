<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novamind Inventory and Billing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #ff9a9e, #fecfef, #fecfef, #ffecd2);
            color: #333;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #fff;
            background: #ff6b6b;
            padding: 10px;
            border-radius: 10px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .tab {
            display: none;
        }
        .tab.active {
            display: block;
        }
        .tab-buttons {
            text-align: center;
            margin-bottom: 20px;
        }
        .tab-buttons button {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .tab-buttons button.active {
            background: #45b7aa;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #ffeaa7;
        }
        button {
            background: #fd79a8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #e84393;
        }
        input, select {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .totals {
            text-align: right;
            font-weight: bold;
            color: #d63031;
        }
        .bill-preview {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        .bill-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .bill-footer {
            text-align: center;
            margin-top: 20px;
            font-style: italic;
        }
        .store-details {
            margin-bottom: 20px;
        }
        .store-details input {
            width: 100%;
            margin-bottom: 10px;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .bill-preview, .bill-preview * {
                visibility: visible;
            }
            .bill-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                background: white;
            }
        }
    </style>
</head>
<body>
    <h1>Novamind Inventory and Billing</h1>
    <div class="container">
        <div class="tab-buttons">
            <button onclick="showTab('products')">Product Management</button>
            <button onclick="showTab('billing')">Billing</button>
        </div>

        <div id="products" class="tab active">
            <h2>Product Management</h2>
            <table id="productTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Price (per kg)</th>
                        <th>Stock (kg)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button onclick="addProduct()">Add Product</button>
        </div>

        <div id="billing" class="tab">
            <h2>Billing</h2>
            <div class="store-details">
                <input type="text" id="storeName" placeholder="Provision Store Name" value="My Provision Store">
                <input type="text" id="storeAddress" placeholder="Address" value="123 Main Street, City">
                <input type="text" id="storePhone" placeholder="Phone No" value="123-456-7890">
                <input type="text" id="customerName" placeholder="Customer Name (optional)">
            </div>
            <div>
                <input type="text" id="productSelect" list="productList" placeholder="Search and Select Product">
                <datalist id="productList"></datalist>
                <input type="number" id="quantity" step="0.01" min="0" placeholder="Quantity (e.g., 2.4 for 2kg 400gms)">
                <button onclick="addToCart()">Add to Cart</button>
            </div>
            <table id="cartTable">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Total</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="totals">
                <p>Subtotal: <span id="subtotal">0.00</span></p>
                <p>GST (%): <input type="number" id="gstPercent" min="0" step="0.01" placeholder="0.00"></p>
                <p>GST Amount: <span id="gstAmount">0.00</span></p>
                <p>Total: <span id="total">0.00</span></p>
            </div>
            <button onclick="generateBill()">Generate Bill</button>
            <button onclick="printBill()" id="printBtn" style="display: none;">Print Bill</button>
            <div id="billPreview" class="bill-preview" style="display: none;"></div>
        </div>
    </div>

    <script>
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let cart = [];

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-buttons button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            if (tabName === 'billing') updateProductList();
        }

        function updateProductTable() {
            const tbody = document.querySelector('#productTable tbody');
            tbody.innerHTML = '';
            products.forEach((prod, index) => {
                const row = `<tr>
                    <td>${prod.name}</td>
                    <td>${prod.price}</td>
                    <td>${prod.stock}</td>
                    <td>
                        <button onclick="editProduct(${index})">Edit</button>
                        <button onclick="deleteProduct(${index})">Delete</button>
                    </td>
                </tr>`;
                tbody.innerHTML += row;
            });
            localStorage.setItem('products', JSON.stringify(products));
        }

        function addProduct() {
            const name = prompt('Product Name:');
            const price = parseFloat(prompt('Price per kg:'));
            const stock = parseFloat(prompt('Stock (kg):'));
            if (name && !isNaN(price) && !isNaN(stock)) {
                products.push({ name, price, stock });
                updateProductTable();
                updateProductList();
            }
        }

        function editProduct(index) {
            const prod = products[index];
            const name = prompt('Product Name:', prod.name);
            const price = parseFloat(prompt('Price per kg:', prod.price));
            const stock = parseFloat(prompt('Stock (kg):', prod.stock));
            if (name && !isNaN(price) && !isNaN(stock)) {
                products[index] = { name, price, stock };
                updateProductTable();
                updateProductList();
            }
        }

        function deleteProduct(index) {
            products.splice(index, 1);
            updateProductTable();
            updateProductList();
        }

        function updateProductList() {
            const datalist = document.getElementById('productList');
            datalist.innerHTML = '';
            products.forEach(prod => {
                datalist.innerHTML += `<option value="${prod.name}">`;
            });
        }

        function addToCart() {
            const prodName = document.getElementById('productSelect').value;
            const qtyKg = parseFloat(document.getElementById('quantity').value);
            if (!prodName || isNaN(qtyKg) || qtyKg <= 0) return alert('Select product and enter valid quantity');
            const prod = products.find(p => p.name === prodName);
            if (!prod) return alert('Product not found');
            if (prod.stock < qtyKg) return alert('Insufficient stock');
            const price = prod.price * qtyKg;
            // Format quantity display as kg gms
            const kg = Math.floor(qtyKg);
            const gms = Math.round((qtyKg - kg) * 1000);
            const qtyDisplay = gms > 0 ? `${kg}kg ${gms}gms` : `${kg}kg`;
            cart.push({ product: prod, qty: qtyDisplay, qtyKg, price: price.toFixed(2) });
            updateCartTable();
        }

        function updateCartTable() {
            const tbody = document.querySelector('#cartTable tbody');
            tbody.innerHTML = '';
            let subtotal = 0;
            cart.forEach((item, index) => {
                subtotal += parseFloat(item.price);
                const row = `<tr>
                    <td>${item.product.name}</td>
                    <td>${item.qty}</td>
                    <td>${item.price}</td>
                    <td>${item.price}</td>
                    <td><button onclick="removeFromCart(${index})">Remove</button></td>
                </tr>`;
                tbody.innerHTML += row;
            });
            document.getElementById('subtotal').textContent = subtotal.toFixed(2);
            updateTotals();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartTable();
        }

        function updateTotals() {
            const gstPercent = parseFloat(document.getElementById('gstPercent').value) || 0;
            const subtotal = parseFloat(document.getElementById('subtotal').textContent);
            const gstAmount = (subtotal * gstPercent) / 100;
            const total = subtotal + gstAmount;
            document.getElementById('gstAmount').textContent = gstAmount.toFixed(2);
            document.getElementById('total').textContent = total.toFixed(2);
        }

        document.getElementById('gstPercent').addEventListener('input', updateTotals);

        function getCurrentDateTimeIST() {
            return new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
        }

        function generateBill() {
            if (cart.length === 0) return alert('Cart is empty');
            // Deduct stock
            cart.forEach(item => {
                const prod = products.find(p => p.name === item.product.name);
                if (prod) prod.stock -= item.qtyKg;
            });
            updateProductTable();
            const storeName = document.getElementById('storeName').value || 'Provision Store';
            const address = document.getElementById('storeAddress').value || 'Address';
            const contact = document.getElementById('storePhone').value || 'Contact';
            const customerName = document.getElementById('customerName').value.trim();
            const dateTime = getCurrentDateTimeIST();
            let billHTML = `<div class="bill-header">
                <h2>${storeName}</h2>
                <p>${address}</p>
                <p>Contact: ${contact}</p>
                <p>Date & Time: ${dateTime}</p>
                ${customerName ? `<p>Customer: ${customerName}</p>` : ''}
            </div>
            <table><tr><th>Product</th><th>Qty</th><th>Price</th><th>Total</th></tr>`;
            cart.forEach(item => {
                billHTML += `<tr><td>${item.product.name}</td><td>${item.qty}</td><td>${item.price}</td><td>${item.price}</td></tr>`;
            });
            billHTML += `</table><p>Subtotal: ${document.getElementById('subtotal').textContent}</p><p>GST (${document.getElementById('gstPercent').value}%): ${document.getElementById('gstAmount').textContent}</p><p>Total: ${document.getElementById('total').textContent}</p>
            <div class="bill-footer">Thank you, visit again!</div>`;
            document.getElementById('billPreview').innerHTML = billHTML;
            document.getElementById('billPreview').style.display = 'block';
            document.getElementById('printBtn').style.display = 'inline-block';
            cart = [];
            updateCartTable();
        }

        function printBill() {
            window.print();
        }

        // Initialize
        updateProductTable();
    </script>
</body>
</html>